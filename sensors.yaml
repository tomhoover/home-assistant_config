- platform: yr

- platform: arlo
#  monitored_conditions:
#    - captured_today
#    - last_capture
#    - total_cameras
#    - battery_level
#    - signal_strength

- platform: pi_hole
  host: '192.168.2.92'
  monitored_conditions:
    - ads_blocked_today
    - ads_percentage_today
    - dns_queries_today
    - domains_being_blocked
    - queries_cached
    - queries_forwarded
    - unique_clients
    - unique_domains
    - clients_ever_seen

- platform: darksky
  api_key: !secret darksky_api_key
  update_interval:
    minutes: 3
  monitored_conditions:
    - summary
    - minutely_summary
    - hourly_summary
    - daily_summary
##  - precip_type returns sensor.dark_sky_precip
    - precip_type
    - precip_intensity
##  - precip_intensity_max returns sensor.dark_sky_daily_max_precip_intensity
    - precip_intensity_max
    - precip_probability
    - precip_accumulation
    - temperature
##  - temperature_high returns sensor.dark_sky_daytime_high_temperature
    - temperature_high
##  - temperature_low returns sensor.dark_sky_overnight_low_temperature
    - temperature_low
#   - dew_point
    - apparent_temperature
##  - apparent_temperature_high returns sensor.dark_sky_daytime_high_apparent_temperature
#   - apparent_temperature_high
##  - apparent_temperature_low returns sensor.dark_sky_overnight_low_apparent_temperature
#   - apparent_temperature_low
    - wind_bearing
    - wind_speed
##  - cloud_cover returns sensor.dark_sky_cloud_coverage
    - cloud_cover
    - humidity
#   - pressure
    - visibility
#   - ozone
#   - uv_index
#   - icon
    - nearest_storm_bearing
    - nearest_storm_distance

- platform: mqtt
  state_topic: !secret tom_pizw-0_topic
  value_template: '{{ value_json.confidence }}'
  unit_of_measurement: '%'
  name: 'Tom Media Closet'

- platform: mqtt
  state_topic: !secret mitzi_pizw-0_topic
  value_template: '{{ value_json.confidence }}'
  unit_of_measurement: '%'
  name: 'Mitzi Media Closet'

- platform: mqtt
  state_topic: !secret brandon_pizw-0_topic
  value_template: '{{ value_json.confidence }}'
  unit_of_measurement: '%'
  name: 'Brandon Media Closet'

- platform: mqtt
  state_topic: !secret krystle_pizw-0_topic
  value_template: '{{ value_json.confidence }}'
  unit_of_measurement: '%'
  name: 'Krystle Media Closet'

#- platform: mqtt
#  state_topic: 'location/second floor/00:00:00:00:00:00'
#  value_template: '{{ value_json.confidence }}'
#  unit_of_measurement: '%'
#  name: 'Andrew Second Floor'
#
#- platform: mqtt
#  state_topic: 'location/third floor/00:00:00:00:00:00'
#  value_template: '{{ value_json.confidence }}'
#  unit_of_measurement: '%'
#  name: 'Andrew Third Floor'
#
#- platform: mqtt
#  state_topic: 'location/garage/00:00:00:00:00:00'
#  value_template: '{{ value_json.confidence }}'
#  unit_of_measurement: '%'
#  name: 'Andrew Garage'

- platform: min_max
  name: "Tom Home Occupancy Confidence"
  type: max
  round_digits: 0
  entity_ids:
    - sensor.tom_media_closet
#    - sensor.andrew_garage
#    - sensor.andrew_third_floor
#    - sensor.andrew_second_floor
#    - sensor.andrew_first_floor

- platform: min_max
  name: "Mitzi Home Occupancy Confidence"
  type: max
  round_digits: 0
  entity_ids:
    - sensor.mitzi_media_closet

- platform: min_max
  name: "Brandon Home Occupancy Confidence"
  type: max
  round_digits: 0
  entity_ids:
    - sensor.brandon_media_closet

- platform: min_max
  name: "Krystle Home Occupancy Confidence"
  type: max
  round_digits: 0
  entity_ids:
    - sensor.krystle_media_closet

#- platform: template
#  sensors:
#    tom_badge:
#      unit_of_measurement: Tom
#      entity_id: group.tom_presence
#      friendly_name_template: >
#        {% if is_state('group.tom_presence', 'home') %}
#          Home
#        {% else %}
#          Away
#        {% endif %}
#      value_template: >
#        {% if is_state('group.tom_presence', 'home') %}
#          Home
#        {% else %}
#          Away
#        {% endif %}
#      entity_picture_template: !secret tom_pic

- platform: template
  sensors:
#    frontdoorbattery:
#      entity_id: zwave.front_deadbolt
#      value_template: "{{ states.zwave.front_deadbolt.attributes.battery_level }}"
#      friendly_name: 'Front Door Lock Battery'
#      unit_of_measurement: '%'
    # this sensor is intended to capture the user number that was used during
    # the last operation that required a code to be entered.  it will persist
    # after subsequent other events (manual locking, etc.) that didn't involve
    # a user code
    front_door_code:
      friendly_name: Front Door Last Code
      entity_id:
        - sensor.front_deadbolt_alarm_type
        - sensor.front_deadbolt_alarm_level
      value_template: >-
        {% if is_state('sensor.front_deadbolt_alarm_type', '18') or
              is_state('sensor.front_deadbolt_alarm_type', '19') %}
          {% if not is_state('sensor.front_deadbolt_alarm_level', '0') %}
            {{states('sensor.front_deadbolt_alarm_level')}}
          {% else %}
            {# just provide previous value if no user code entered #}
            {{states('sensor.front_door_code')}}
          {% endif %}
        {% else %}
          {# just provide previous value if no user code entered #}
          {{states('sensor.front_door_code')}}
        {% endif %}
    front_last_action:
      friendly_name: 'Front Door Last Action'
      entity_id:
        - sensor.front_deadbolt_alarm_type
        - sensor.front_deadbolt_alarm_level
      value_template: >-
        {% if is_state('sensor.front_deadbolt_alarm_type', '18') %}
          {% if is_state('sensor.front_deadbolt_alarm_level', '0') %}
        Locked: Outside Keypad
          {% else %}
        Locked: User {{states('sensor.front_deadbolt_alarm_level')}}
          {% endif %}
        {% elif is_state('sensor.front_deadbolt_alarm_type', '19') %}
          Unlocked: User Code {{states('sensor.front_deadbolt_alarm_level')}}
        {% elif is_state('sensor.front_deadbolt_alarm_type', '21') %}
          Locked: {{[ 'Outside Lock', 'Inside Deadbolt', 'Outside Keypad' ][states('sensor.front_deadbolt_alarm_level')|int]}}
        {% elif is_state('sensor.front_deadbolt_alarm_type', '22') %}
          Unlocked: Inside Deadbolt
        {% else %}
          Unknown: {{states('sensor.front_deadbolt_alarm_type')}}/{{states('sensor.front_deadbolt_alarm_level')}}
        {% endif %}

    downstairs_cool_temperature:
      friendly_name: "Cool setting"
      unit_of_measurement: 'degrees'
      value_template: "{{ states.climate.ct101_thermostat_downstairs_cooling_1.attributes.temperature }}"
    downstairs_heat_temperature:
      friendly_name: "Heat setting"
      unit_of_measurement: 'degrees'
      value_template: "{{ states.climate.ct101_thermostat_downstairs_heating_1.attributes.temperature }}"

    upstairs_cool_temperature:
      friendly_name: "Cool setting"
      unit_of_measurement: 'degrees'
      value_template: "{{ states.climate.ct101_thermostat_upstairs_cooling_1.attributes.temperature }}"
    upstairs_heat_temperature:
      friendly_name: "Heat setting"
      unit_of_measurement: 'degrees'
      value_template: "{{ states.climate.ct101_thermostat_upstairs_heating_1.attributes.temperature }}"
